function clearSeen(){for(var o=0;size>o;o++)for(var e=0;size>e;e++)seen[o][e]=!1}function makeGrid(){solved=!1;for(var o=0;size>o;o++)grid[o]=[],original[o]=[],cells[o]=[],seen[o]=[];var e=$("#grid");e.empty();for(var o=0;size>o;o++){var t=$("<tr></tr>");e.append(t);for(var n=0;size>n;n++){var r=$("<td></td>");r.addClass("cell"),t.append(r);var l=Math.floor(Math.random()*colours.length);r.css("background-color","#"+colours[l]),r.height(Math.floor(420/size)),r.width(Math.floor(420/size)),cells[o][n]=r,grid[o][n]=l,original[o][n]=l}}computerSolve(),updateTurn(0)}function makeControls(){var o=$("#palette");o.empty();for(var e=0;e<colours.length;e++){var t=$("<button></button>");t.addClass("palette-colour"),t.attr("value",e),t.css("background-color","#"+colours[e]),o.append(t)}$(".palette-colour").click(function(){flood(Number($(this).val()))})}function check(){for(var o=0;size>o;o++)for(var e=0;size>e;e++)if(grid[o][e]!=grid[0][0])return!1;return!0}function updateTurn(o){turn=o,$("#counter").html(o),0===o&&$("#solve-button").show()}function reset(){for(var o=0;size>o;o++)for(var e=0;size>e;e++)grid[o][e]=original[o][e],computingMode||cells[o][e].css("background-color","#"+colours[grid[o][e]]);updateTurn(0)}function refresh(){for(var o=0;size>o;o++)for(var e=0;size>e;e++)cells[o][e].css("background-color","#"+colours[grid[o][e]])}function _flood(o,e,t,n){0>o||0>e||o>=size||e>=size||seen[o][e]||(seen[o][e]=!0,grid[o][e]==t&&(grid[o][e]=n,computingMode||cells[o][e].css("background-color","#"+colours[n]),_flood(o,e+1,t,n),_flood(o,e-1,t,n),_flood(o+1,e,t,n),_flood(o-1,e,t,n)))}function flood(o){grid[0][0]!=o&&(clearSeen(),_flood(0,0,grid[0][0],o),updateTurn(++turn),solved||computingMode||!check()?computerSolution===turn&&alert("You failed to complete the challenge."):(alert(computerSolution>=turn?"You completed the challenge!":"Puzzle cleared in "+turn+" moves!"),solved=!0,$("#solve-button").hide()))}function countConnected(o,e,t){return 0>o||0>e||o>=size||e>=size||seen[o][e]||grid[o][e]!=t?0:(seen[o][e]=!0,countConnected(o,e-1,t)+countConnected(o,e+1,t)+countConnected(o-1,e,t)+countConnected(o+1,e,t)+1)}function _inspect(o,e){0>o||0>e||o>=size||e>=size||seen[o][e]||(grid[o][e]===grid[0][0]?(seen[o][e]=!0,_inspect(o,e-1),_inspect(o,e+1),_inspect(o-1,e),_inspect(o+1,e)):list[grid[o][e]]+=countConnected(o,e,grid[o][e]))}function inspect(){clearSeen();for(var o=0;o<colours.length;o++)list[o]=0;_inspect(0,0);for(var e=0,o=0;o<colours.length;o++)list[o]>list[e]&&(e=o);return e}function floodMax(){var o=inspect();flood(o)}function computerSolve(){for(computingMode=!0,computerSolution=0;!check();)floodMax(),computerSolution++;$("#computer-solution").html(computerSolution),reset(),computingMode=!1}function solve(){var o=$("#solve-button"),e=setInterval(function(){check()?(clearInterval(e),o.html(solveLabel)):floodMax()},500);o.html("Stop!").unbind().click(function(){clearInterval(e),o.html(solveLabel).click(solve)})}var size=14,turn,grid=[],original=[],cells=[],seen=[],computingMode=!1,solved=!1,solveLabel,colours=[],list=[],computerSolution=-1;$(document).ready(function(){colours=themes[0].colours,makeGrid(),makeControls(),solveLabel=$("#solve-button").html(),$("#solve-button").click(solve);for(var o=0;o<themes.length;o++)$("#themes").append('<option value="'+o+'">'+themes[o].name+"</option>");$("#themes").change(function(){colours=themes[Number($("#themes option:selected").val())].colours,refresh(),makeControls()}),$("#size").change(function(){confirm("This will start a new game. Continue?")&&(size=Number($("#size option:selected").val()),makeGrid())})});