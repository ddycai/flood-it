function clearSeen(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)seen[e][o]=!1}function makeGrid(){solved=!1;for(var e=0;size>e;e++)grid[e]=[],original[e]=[],cells[e]=[],seen[e]=[];var o=$("#grid");o.empty();for(var e=0;size>e;e++){var t=$("<tr></tr>");o.append(t);for(var r=0;size>r;r++){var n=$("<td></td>");n.addClass("cell"),t.append(n);var l=Math.floor(Math.random()*colours.length);n.css("background-color","#"+colours[l]),n.height(Math.floor(420/size)),n.width(Math.floor(420/size)),cells[e][r]=n,grid[e][r]=l,original[e][r]=l}}computerSolve(),updateTurn(0)}function makeControls(){var e=$("#palette");e.empty();for(var o=0;o<colours.length;o++){var t=$("<button></button>");t.addClass("palette-colour"),t.attr("value",o),t.css("background-color","#"+colours[o]),e.append(t)}$(".palette-colour").click(function(){flood(Number($(this).val()))})}function check(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)if(grid[e][o]!=grid[0][0])return!1;return!0}function updateTurn(e){turn=e,$("#counter").html(e),0===e&&$("#solve-btn").show()}function reset(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)grid[e][o]=original[e][o],computingMode||cells[e][o].css("background-color","#"+colours[grid[e][o]]);updateTurn(0)}function refresh(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)cells[e][o].css("background-color","#"+colours[grid[e][o]])}function _flood(e,o,t,r){0>e||0>o||e>=size||o>=size||seen[e][o]||(seen[e][o]=!0,grid[e][o]==t&&(grid[e][o]=r,computingMode||cells[e][o].css("background-color","#"+colours[r]),_flood(e,o+1,t,r),_flood(e,o-1,t,r),_flood(e+1,o,t,r),_flood(e-1,o,t,r)))}function flood(e){grid[0][0]!=e&&(clearSeen(),_flood(0,0,grid[0][0],e),updateTurn(++turn),solved||computingMode||!check()?computerSolution===turn&&alert(failMsg):(alert(computerSolution>=turn?successMsg:"Puzzle cleared in "+turn+" moves!"),solved=!0,$("#solve-btn").hide()))}function countConnected(e,o,t){return 0>e||0>o||e>=size||o>=size||seen[e][o]||grid[e][o]!=t?0:(seen[e][o]=!0,countConnected(e,o-1,t)+countConnected(e,o+1,t)+countConnected(e-1,o,t)+countConnected(e+1,o,t)+1)}function _inspect(e,o){0>e||0>o||e>=size||o>=size||seen[e][o]||(grid[e][o]===grid[0][0]?(seen[e][o]=!0,_inspect(e,o-1),_inspect(e,o+1),_inspect(e-1,o),_inspect(e+1,o)):list[grid[e][o]]+=countConnected(e,o,grid[e][o]))}function inspect(){clearSeen();for(var e=0;e<colours.length;e++)list[e]=0;_inspect(0,0);for(var o=0,e=0;e<colours.length;e++)list[e]>list[o]&&(o=e);return o}function floodMax(){var e=inspect();flood(e)}function computerSolve(){for(computingMode=!0,computerSolution=0;!check();)floodMax(),computerSolution++;$("#computer-solution").html(computerSolution),reset(),computingMode=!1}function solve(){var e=$("#solve-btn"),o=setInterval(function(){check()?(clearInterval(o),e.html(solveLabel)):floodMax()},500);e.html("Stop!").unbind().click(function(){clearInterval(o),e.html(solveLabel).click(solve)})}var size=14,turn,grid=[],original=[],cells=[],seen=[],computingMode=!1,solved=!1,solveLabel,colours=[],successMsg="You bested the computer!",failMsg="You failed to beat the computer. :(",list=[],computerSolution=-1;$(document).ready(function(){$('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip(),colours=themes[0].colours,makeGrid(),makeControls(),solveLabel=$("#solve-btn").html(),$("#solve-btn").click(solve),$("#new-game-btn").click(makeGrid),$("#reset-btn").click(reset);for(var e=0;e<themes.length;e++)$("#themes").append('<option value="'+e+'">'+themes[e].name+"</option>");$("#themes").change(function(){colours=themes[Number($("#themes option:selected").val())].colours,refresh(),makeControls()}),$("#size").change(function(){confirm("This will start a new game. Continue?")&&(size=Number($("#size option:selected").val()),makeGrid())})});