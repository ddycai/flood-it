function clearSeen(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)seen[e][o]=!1}function makeGrid(){solved=!1
for(var e=0;size>e;e++)grid[e]=[],original[e]=[],cells[e]=[],seen[e]=[]
var o,t,n,r=$("#grid")
r.empty()
for(var e=0;size>e;e++){o=$("<tr>")
for(var l=0;size>l;l++)n=Math.floor(Math.random()*colours.length),t=$("<td>"),t.addClass("cell"),o.append(t),t.css("background-color","#"+colours[n]),t.height(Math.floor(420/size)),t.width(Math.floor(420/size)),cells[e][l]=t,grid[e][l]=n,original[e][l]=n
r.append(o)}computerSolve(),updateTurn(0)}function makeControls(){var e=$("#palette")
e.empty()
for(var o=0;o<colours.length;o++){var t=$("<button>")
t.addClass("palette-colour"),t.attr("value",o),t.css("background-color","#"+colours[o]),e.append(t)}$(".palette-colour").click(function(){flood(Number($(this).val()))})}function updateTurn(e){turn=e,$("#counter").html(e),0===e&&$("#solve-btn").show()}function reset(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)grid[e][o]=original[e][o],computingMode||cells[e][o].css("background-color","#"+colours[grid[e][o]])
updateTurn(0)}function refresh(){for(var e=0;size>e;e++)for(var o=0;size>o;o++)cells[e][o].css("background-color","#"+colours[grid[e][o]])}function _flood(e,o,t,n){return 0>e||0>o||e>=size||o>=size||seen[e][o]?0:(seen[e][o]=!0,grid[e][o]===t?(grid[e][o]=n,computingMode||cells[e][o].css("background-color","#"+colours[n]),1+_flood(e,o+1,t,n)+_flood(e,o-1,t,n)+_flood(e+1,o,t,n)+_flood(e-1,o,t,n)):grid[e][o]===n?1:0)}function flood(e){if(grid[0][0]==e)return!1
clearSeen()
var o=_flood(0,0,grid[0][0],e)
console.log(o)
var t=o===size*size
return updateTurn(++turn),computingMode||solverMode||(!solved&&t?(computerSolution>=turn?alert(successMsg):alert("Puzzle cleared in "+turn+" moves!"),solved=!0,$("#solve-btn").hide()):computerSolution===turn&&alert(failMsg)),t}function countConnected(e,o,t){return 0>e||0>o||e>=size||o>=size||seen[e][o]||grid[e][o]!=t?0:(seen[e][o]=!0,countConnected(e,o-1,t)+countConnected(e,o+1,t)+countConnected(e-1,o,t)+countConnected(e+1,o,t)+1)}function _inspect(e,o){0>e||0>o||e>=size||o>=size||seen[e][o]||(grid[e][o]===grid[0][0]?(seen[e][o]=!0,_inspect(e,o-1),_inspect(e,o+1),_inspect(e-1,o),_inspect(e+1,o)):list[grid[e][o]]+=countConnected(e,o,grid[e][o]))}function inspect(){clearSeen()
for(var e=0;e<colours.length;e++)list[e]=0
_inspect(0,0)
for(var o=0,e=0;e<colours.length;e++)list[e]>list[o]&&(o=e)
return o}function floodMax(){var e=inspect()
return flood(e)}function computerSolve(){for(computingMode=!0,computerSolution=1;!floodMax();)computerSolution++
$("#computer-solution").html(computerSolution),reset(),computingMode=!1}function solve(){var e=$("#solve-btn"),o=setInterval(function(){solverMode=!0,floodMax()&&(clearInterval(o),e.html(solveLabel)),solverMode=!1},500)
e.html("Stop!").unbind().click(function(){clearInterval(o),e.html(solveLabel).click(solve)})}var size=14,turn,grid=[],original=[],cells=[],seen=[],computingMode=!1,solverMode=!1,solved=!1,solveLabel,colours=[],successMsg="You bested the computer!",failMsg="You failed to beat the computer. :(",list=[],computerSolution=-1
$(document).ready(function(){$('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip(),colours=themes[0].colours,makeGrid(),makeControls(),solveLabel=$("#solve-btn").html(),$("#solve-btn").click(solve),$("#new-game-btn").click(makeGrid),$("#reset-btn").click(reset),$themes=$("#themes")
for(var e=0;e<themes.length;e++)$option=$("<option>"),$option.val(e),$option.text(themes[e].name),$themes.append($option)
$("#themes").change(function(){colours=themes[Number($(this).find("option:selected").val())].colours,refresh(),makeControls()}),$("#size").change(function(){confirm("This will start a new game. Continue?")&&(size=Number($(this).find("option:selected").val()),makeGrid())})})
